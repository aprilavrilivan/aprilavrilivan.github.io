<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Colorizing the Prokudin-Gorskii photo collection</title>
  <meta name="description" content="CS180/280A Project 1: Colorizing the Prokudin‚ÄëGorskii photo collection" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* ------------------------------
       Theme & Reset
    ------------------------------ */
    :root{
      --bg: #0b0c10;
      --panel: #111318;
      --text: #e6e8ec;
      --muted: #a6adbb;
      --accent: #7c9cff;
      --accent-2: #4ad6a7;
      --bdr: #1e2230;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius-xl: 18px;
      --radius-lg: 14px;
      --radius-md: 12px;
      --radius-sm: 10px;
      --blur: saturate(120%) blur(0px);
    }
    [data-theme="light"]{
      --bg: #f6f7fb;
      --panel: #ffffff;
      --text: #0b1220;
      --muted: #5c6475;
      --accent: #3a66ff;
      --accent-2: #0dbb8e;
      --bdr: #e8ebf3;
      --shadow: 0 16px 40px rgba(16,24,40,.08);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 600px at 10% -10%, rgba(124,156,255,.12), transparent 60%),
                  radial-gradient(900px 500px at 100% 0%, rgba(74,214,167,.12), transparent 60%),
                  var(--bg);
      color: var(--text);
      line-height: 1.6;
    }

    /* ------------------------------
       Layout
    ------------------------------ */
    .wrap { max-width: 1080px; margin: 0 auto; padding: 32px 20px 80px; }
    header.site {
      position: sticky; top: 0; z-index: 50;
      backdrop-filter: var(--blur);
      background: color-mix(in oklab, var(--bg) 70%, transparent);
      border-bottom: 1px solid var(--bdr);
    }
    .site-inner { max-width: 1080px; margin: 0 auto; padding: 14px 20px; display: flex; align-items: center; gap: 12px; }
    .logo {
      width: 40px; height: 40px; display: grid; place-items:center; border-radius: 12px;
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      color: #fff; font-weight: 800;
      box-shadow: var(--shadow);
    }
    .brand { font-weight: 700; letter-spacing: .3px; }
    .grow { flex: 1; }

    .actions { display: flex; align-items: center; gap: 10px; }
    .btn, a.btn { appearance: none; border: 0; cursor: pointer; text-decoration: none; color: #fff; font-weight: 600; }
    .btn.primary { padding: 10px 14px; border-radius: 10px; background: linear-gradient(135deg, var(--accent), var(--accent-2)); box-shadow: var(--shadow); transition: transform .2s ease, box-shadow .2s ease, filter .2s ease; }
    .btn.primary:hover { transform: translateY(-1px); filter: saturate(110%); }
    .btn.ghost { padding: 10px 12px; border-radius: 10px; color: var(--text); background: transparent; border: 1px solid var(--bdr); }

    h1.page-title { font-size: clamp(22px, 2.4vw, 32px); margin: 18px 0 8px; }
    p.lead { color: var(--muted); margin: 0 0 22px; }

    /* ------------------------------
       Panels
    ------------------------------ */
    .panel { background: var(--panel); border: 1px solid var(--bdr); border-radius: var(--radius-xl); box-shadow: var(--shadow); overflow: hidden; }
    .panel .panel-hd { padding: 18px 20px; border-bottom: 1px solid var(--bdr); display: flex; align-items: center; justify-content: space-between; gap: 10px; }
    .panel .panel-hd h2 { margin: 0; font-size: 18px; }
    .panel .panel-bd { padding: 14px 16px 6px; }

    /* ------------------------------
       Tables ‚Üí Responsive Cards
    ------------------------------ */
    .tbl { width: 100%; border-collapse: separate; border-spacing: 0; }
    .tbl th, .tbl td { padding: 12px 14px; border-bottom: 1px solid var(--bdr); vertical-align: middle; }
    .tbl thead th { text-align: left; font-size: 13px; letter-spacing: .4px; color: var(--muted); text-transform: uppercase; }
    .tbl tbody tr { transition: background .2s ease, transform .08s ease; }
    .tbl tbody tr:hover { background: color-mix(in oklab, var(--panel) 85%, #000 15%); }
    .tbl img { width: 180px; height: auto; border-radius: 12px; display: block; border: 1px solid var(--bdr); box-shadow: var(--shadow); }

    /* Make it look like card list on small screens */
    @media (max-width: 760px){
      .tbl thead { display: none; }
      .tbl, .tbl tbody, .tbl tr, .tbl td { display: block; width: 100%; }
      .tbl tr { background: var(--panel); border: 1px solid var(--bdr); border-radius: var(--radius-lg); margin: 10px 0 16px; padding: 12px; }
      .tbl td { border: 0; padding: 8px 0; }
      .tbl td[data-label]::before { content: attr(data-label)"Ôºö"; display: inline-block; min-width: 9em; color: var(--muted); font-weight: 600; }
      .tbl img { width: 100%; }
    }

    /* Image zoom on hover */
    .thumb { position: relative; overflow: hidden; border-radius: 12px; }
    .thumb img { transform: scale(1); transition: transform .35s ease; }
    .thumb:hover img { transform: scale(1.04); }

    /* Tag pills for shifts */
    .pills { display: inline-flex; gap: 8px; flex-wrap: wrap; }
    .pill { display: inline-flex; align-items: center; gap: 6px; font-weight: 600; font-size: 12px; padding: 6px 10px; border-radius: 999px; border: 1px dashed var(--bdr); color: var(--text); background: color-mix(in oklab, var(--panel) 85%, #000 15%); }
    .pill .dot { width: 8px; height: 8px; border-radius: 999px; background: var(--accent); box-shadow: 0 0 0 2px color-mix(in oklab, var(--accent) 20%, transparent); }
    .pill.red .dot { background: #ff6b6b; }
    .pill.green .dot { background: #4ad6a7; }

    /* Footer */
    footer { margin: 28px 0; display: flex; align-items: center; gap: 12px; }
    .link { color: #fff; text-decoration: none; }

    /* Back button */
    .back-btn { display: inline-flex; align-items: center; gap: 8px; font-weight: 700; padding: 12px 16px; border-radius: 12px; border: 1px solid var(--bdr); background: linear-gradient(180deg, color-mix(in oklab, var(--panel) 90%, #fff 10%), var(--panel)); text-decoration: none; color: var(--text); box-shadow: var(--shadow); transition: transform .2s ease, background .2s ease; }
    .back-btn:hover { transform: translateY(-1px); }

    /* Utility */
    .muted { color: var(--muted); }
    .right { text-align: right; }

    /* Mini step box */
    .mini-box {
      margin: 12px 4px 8px;
      background: color-mix(in oklab, var(--panel) 92%, #000 8%);
      border: 1px dashed var(--bdr);
      border-radius: 12px;
      box-shadow: var(--shadow);
      padding: 12px 14px;
    }
    .mini-box .mini-hd{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      font-weight:700; font-size:14px;
    }
    .mini-box .mini-hd .hint{ color: var(--muted); font-weight:600; font-size:12px; }
    .mini-box .mini-bd{ margin-top:10px; color: var(--text); }
    .mini-box ol{ margin: 6px 0 0 18px; padding:0; }
    .mini-box li{ margin: 4px 0; line-height: 1.5; }
    .mini-toggle{
      appearance:none; border:1px solid var(--bdr); background:transparent; color:var(--text);
      font-weight:600; border-radius:10px; padding:6px 10px; cursor:pointer;
    }
    .mini-toggle:hover{ filter:saturate(110%); transform: translateY(-1px); }
    @media (max-width:760px){ .mini-box{ padding: 10px 12px; } }
  </style>
</head>


  
<body>
  <!-- Sticky Header -->
  <header class="site">
    <div class="site-inner">
      <div class="logo" aria-hidden="true">P1</div>
      <div class="brand">CS180/280A ¬∑ Project 1</div>
      <div class="grow"></div>
      <div class="actions">
        <button class="btn ghost" id="themeToggle" aria-label="Switch Theme">üåì Theme</button>
        <a class="btn primary" href="../index.html">back to main</a>
      </div>
    </div>
  </header>

  <main class="wrap">
    <h1 class="page-title">Images of the Russian Empire: Colorizing the Prokudin-Gorskii photo collection</h1>
    <p class="lead">Prokudin-Gorskii photo collection stores a set of old pictures, each with seperated RGB channels. This project aims to recover the colorful pictures by precisely align and stack back these channels. The project first succeed on recovering the simple .jpg photos by matching the brightness of each pixel in G and R channel with its surrounding pixels in B channel. For larger .tif photos, searching every pixel using brute-force is time consuming, so a image pyramid is constructed to accelerate the process. Finally, an edge extraction step is add to ensure a more robust alignment. The step description, findings during implementation, final outcomes for each image and their R and G channel shift parameters are listed below.</span>.</p>

    <!-- Simple JPGs -->
    <section class="panel" aria-labelledby="sec-simple">
      <div class="panel-hd">
        <h2 id="sec-simple">Colorizing simple JPG images</h2>
        <span class="muted">3 in total</span>
      </div>
      <div class="panel-bd">
        <!-- Small step box -->
        <div class="mini-box" id="steps-simple">
          <div class="mini-hd">
            <span>Simple Alignment</span>
            <span class="hint">Step Description</span>
            <button class="mini-toggle" type="button" data-target="#steps-simple-body">Hide</button>
          </div>
          <div class="mini-bd" id="steps-simple-body">
            <ol>
              <li>Import the cv2 package, read the images, and split the concatenated long image to BGR channels.</li>
              <li>Crop borders of BGR images to reduce noise brought by them.</li>
              <li>Align <strong>G</strong> and <strong>R</strong> to <strong>B</strong> via exhaustively matching brightness of every pixel with its surrounding pixels (SSD or NCC algorithm with searching range [-15, 15]).</li>
              <li>Apply the best shift parameters to G and R channels and stack them back with B channel to get an RGB image.</li>
            </ol>
          </div>
        </div>
        <!-- Small finding box -->
        <div class="mini-box" id="findings-simple">
          <div class="mini-hd">
            <span>Simple Alignment</span>
            <span class="hint">Findings sharing</span>
            <button class="mini-toggle" type="button" data-target="#findings-simple-body">Hide</button>
          </div>
          <div class="mini-bd" id="findings-simple-body">
            <ol>
              <li>NCC performs better than SSD in aligning RGB channels, as NCC normalized the brightness of pixels, making it less sensitive to brightness and contrast differences.</li>
              <li>Croping boarders by 13% of the orginal image appears effective.</li>
            </ol>
          </div>
        </div>
        <!-- The table -->
        <table class="tbl">
          <thead>
            <tr>
              <th>Image</th>
              <th>G channel shifting</th>
              <th>R channel shifting</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td data-label="Image">
                <div class="thumb"><img src="./media/cathedral.jpg" alt="cathedral.jpg" loading="lazy"></div>
              </td>
              <td data-label="G channel shifting"><span class="pills"><span class="pill green"><span class="dot"></span>(2, 5)</span></span></td>
              <td data-label="R channel shifting"><span class="pills"><span class="pill red"><span class="dot"></span>(3, 12)</span></span></td>
            </tr>
            <tr>
              <td data-label="Image">
                <div class="thumb"><img src="./media/monastery.jpg" alt="monastery.jpg" loading="lazy"></div>
              </td>
              <td data-label="G channel shifting"><span class="pills"><span class="pill green"><span class="dot"></span>(2, -3)</span></span></td>
              <td data-label="R channel shifting"><span class="pills"><span class="pill red"><span class="dot"></span>(2, 3)</span></span></td>
            </tr>
            <tr>
              <td data-label="Image">
                <div class="thumb"><img src="./media/tobolsk.jpg" alt="tobolsk.jpg" loading="lazy"></div>
              </td>
              <td data-label="G channel shifting"><span class="pills"><span class="pill green"><span class="dot"></span>(3, 3)</span></span></td>
              <td data-label="R channel shifting"><span class="pills"><span class="pill red"><span class="dot"></span>(3, 6)</span></span></td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Complex TIFFs -->
    <section class="panel" aria-labelledby="sec-complex" style="margin-top: 28px;">
      <div class="panel-hd">
        <h2 id="sec-complex">Colorizing complex TIF images</h2>
        <span class="muted">12 in total</span>
      </div>
      <div class="panel-bd">
        <!-- Complex step box -->
        <div class="mini-box" id="steps-complex">
          <div class="mini-hd">
            <span>Pyramid Alignment</span>
            <span class="hint">Step Description</span>
            <button class="mini-toggle" type="button" data-target="#steps-complex-body">Hide</button>
          </div>
          <div class="mini-bd" id="steps-complex-body">
            <ol>
              <li>Import the cv2 package, read the images, and split the concatenated long image to BGR channels.</li>
              <li>Crop borders of BGR images to reduce noise brought by the edges.</li>
              <li>Construct three image pyramids of BGR channels respectively by iterating the process of Gaussian Blurring and Downsampling.</li>
              <li>Starting from the top of pyramid, iteratively do the following process till bottom: Find best shift of G, R to B by NCC, and add it to current shifting --> times it by two to shift the next level in pyrimid</li>
              <li>Apply the best shifts of BGR and stack them back into an RGB image.</li>
            </ol>
          </div>
        </div>
        <!-- Complex findings box -->
        <div class="mini-box" id="findings-complex">
          <div class="mini-hd">
            <span>Pyramid Alignment</span>
            <span class="hint">Findings Sharing</span>
            <button class="mini-toggle" type="button" data-target="#findings-complex-body">Hide</button>
          </div>
          <div class="mini-bd" id="findings-complex-body">
            <ol>
              <li>In the Gaussian Blurring step, I used "sepfir2d" tool from "scipy.signal" toolbox, with filter = [1/16, 4/16, 6/16, 4/16, 1/16]</li>
              <li>I constructed a pyramid with 6 levels, each layer size shrinks to (1/2)*(1/2) of its predecessor</li>
              <li>The search range is [-5, 5], which proved to be robust, while completing the whole task within 10 sec for all tif pictures</li>
              <li>By just doing the above process, every image can be perfectly aligned except for the R channel of "emir". This is because that channel has a large brightness difference with B channel of that image. I addressed it by interting a edge extraction process right after the cropping step. This is done using cv2.Canny() function</li>
            </ol>
          </div>
        </div>
        <table class="tbl">
          <thead>
            <tr>
              <th>Image</th>
              <th>G channel shifting</th>
              <th>R channel shifting</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td data-label="Image"><div class="thumb"><img src="./media/church.jpeg" alt="church.jpeg" loading="lazy"></div></td>
              <td data-label="G channel shifting"><span class="pills"><span class="pill green"><span class="dot"></span>(3, 25)</span></span></td>
              <td data-label="R channel shifting"><span class="pills"><span class="pill red"><span class="dot"></span>(-4, 58)</span></span></td>
            </tr>
            <tr>
              <td data-label="Image"><div class="thumb"><img src="./media/emir.jpeg" alt="emir.jpeg" loading="lazy"></div></td>
              <td data-label="G channel shifting"><span class="pills"><span class="pill green"><span class="dot"></span>(23, 49)</span></span></td>
              <td data-label="R channel shifting"><span class="pills"><span class="pill red"><span class="dot"></span>(40, 107)</span></span></td>
            </tr>
            <tr>
              <td data-label="Image"><div class="thumb"><img src="./media/harvesters.jpeg" alt="harvesters.jpeg" loading="lazy"></div></td>
              <td data-label="G channel shifting"><span class="pills"><span class="pill green"><span class="dot"></span>(17, 60)</span></span></td>
              <td data-label="R channel shifting"><span class="pills"><span class="pill red"><span class="dot"></span>(10, 124)</span></span></td>
            </tr>
            <tr>
              <td data-label="Image"><div class="thumb"><img src="./media/icon.jpeg" alt="icon.jpeg" loading="lazy"></div></td>
              <td data-label="G channel shifting"><span class="pills"><span class="pill green"><span class="dot"></span>(16, 39)</span></span></td>
              <td data-label="R channel shifting"><span class="pills"><span class="pill red"><span class="dot"></span>(22, 87)</span></span></td>
            </tr>
            <tr>
              <td data-label="Image"><div class="thumb"><img src="./media/italil.jpeg" alt="italil.jpeg" loading="lazy"></div></td>
              <td data-label="G channel shifting"><span class="pills"><span class="pill green"><span class="dot"></span>(22, 40)</span></span></td>
              <td data-label="R channel shifting"><span class="pills"><span class="pill red"><span class="dot"></span>(36, 77)</span></span></td>
            </tr>
            <tr>
              <td data-label="Image"><div class="thumb"><img src="./media/lastochikino.jpeg" alt="lastochikino.jpeg" loading="lazy"></div></td>
              <td data-label="G channel shifting"><span class="pills"><span class="pill green"><span class="dot"></span>(-1, -3)</span></span></td>
              <td data-label="R channel shifting"><span class="pills"><span class="pill red"><span class="dot"></span>(-8, 75)</span></span></td>
            </tr>
            <tr>
              <td data-label="Image"><div class="thumb"><img src="./media/lugano.jpeg" alt="lugano.jpeg" loading="lazy"></div></td>
              <td data-label="G channel shifting"><span class="pills"><span class="pill green"><span class="dot"></span>(-17, 41)</span></span></td>
              <td data-label="R channel shifting"><span class="pills"><span class="pill red"><span class="dot"></span>(-29, 93)</span></span></td>
            </tr>
            <tr>
              <td data-label="Image"><div class="thumb"><img src="./media/melons.jpeg" alt="melons.jpeg" loading="lazy"></div></td>
              <td data-label="G channel shifting"><span class="pills"><span class="pill green"><span class="dot"></span>(10, 80)</span></span></td>
              <td data-label="R channel shifting"><span class="pills"><span class="pill red"><span class="dot"></span>(14, 177)</span></span></td>
            </tr>
            <tr>
              <td data-label="Image"><div class="thumb"><img src="./media/self_portrait.jpeg" alt="self_portrait.jpeg" loading="lazy"></div></td>
              <td data-label="G channel shifting"><span class="pills"><span class="pill green"><span class="dot"></span>(29, 77)</span></span></td>
              <td data-label="R channel shifting"><span class="pills"><span class="pill red"><span class="dot"></span>(37, 175)</span></span></td>
            </tr>
            <tr>
              <td data-label="Image"><div class="thumb"><img src="./media/siren.jpeg" alt="siren.jpeg" loading="lazy"></div></td>
              <td data-label="G channel shifting"><span class="pills"><span class="pill green"><span class="dot"></span>(-8, 48)</span></span></td>
              <td data-label="R channel shifting"><span class="pills"><span class="pill red"><span class="dot"></span>(-23, 96)</span></span></td>
            </tr>
            <tr>
              <td data-label="Image"><div class="thumb"><img src="./media/three_generations.jpeg" alt="three_generations.jpeg" loading="lazy"></div></td>
              <td data-label="G channel shifting"><span class="pills"><span class="pill green"><span class="dot"></span>(12, 56)</span></span></td>
              <td data-label="R channel shifting"><span class="pills"><span class="pill red"><span class="dot"></span>(8, 111)</span></span></td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
    
    <!-- Extra JPGs -->
    <section class="panel" aria-labelledby="sec-simple">
      <div class="panel-hd">
        <h2 id="sec-simple">Colorizing simple JPG images</h2>
        <span class="muted">3 in total</span>
      </div>
      <div class="panel-bd">
        <!-- Small step box -->
        <div class="mini-box" id="steps-simple">
          <div class="mini-hd">
            <span>These are the result of my algorithm on 3 examples of my own choosing, downloaded from the Prokudin-Gorskii collection, each with around 70Mb data size.</span>
          </div>
        </div>
        <!-- The table -->
        <table class="tbl">
          <thead>
            <tr>
              <th>Image</th>
              <th>G channel shifting</th>
              <th>R channel shifting</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td data-label="Image">
                <div class="thumb"><img src="./media/1.jpeg" alt="1.jpeg" loading="lazy"></div>
              </td>
              <td data-label="G channel shifting"><span class="pills"><span class="pill green"><span class="dot"></span>(37,45)</span></span></td>
              <td data-label="R channel shifting"><span class="pills"><span class="pill red"><span class="dot"></span>(58,101)</span></span></td>
            </tr>
            <tr>
              <td data-label="Image">
                <div class="thumb"><img src="./media/2.jpeg" alt="2.jpeg" loading="lazy"></div>
              </td>
              <td data-label="G channel shifting"><span class="pills"><span class="pill green"><span class="dot"></span>(1,35)</span></span></td>
              <td data-label="R channel shifting"><span class="pills"><span class="pill red"><span class="dot"></span>(-2,84)</span></span></td>
            </tr>
            <tr>
              <td data-label="Image">
                <div class="thumb"><img src="./media/3.jpeg" alt="3.jpeg" loading="lazy"></div>
              </td>
              <td data-label="G channel shifting"><span class="pills"><span class="pill green"><span class="dot"></span>(23,54)</span></span></td>
              <td data-label="R channel shifting"><span class="pills"><span class="pill red"><span class="dot"></span>(39,117)</span></span></td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <footer>
      <a class="back-btn" href="../index.html" aria-label="back to main">
        <span>‚Üê back to main</span>
      </a>
  </main>

  <script>
    // Theme toggle with localStorage
    const root = document.documentElement;
    const key = 'pg-theme';
    const btn = document.getElementById('themeToggle');
    const saved = localStorage.getItem(key);
    if(saved){ document.documentElement.setAttribute('data-theme', saved); }
    btn.addEventListener('click', () => {
      const current = document.documentElement.getAttribute('data-theme');
      const next = current === 'light' ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem(key, next);
    });
    // Tiny toggle for mini-box
    document.querySelectorAll('.mini-toggle').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const sel = btn.getAttribute('data-target');
        const box = document.querySelector(sel);
        const hidden = box.style.display === 'none';
        box.style.display = hidden ? '' : 'none';
        btn.textContent = hidden ? 'Hide' : 'Show';
      });
    });
  </script>
</body>
</html>
